---
layout: default
title: snippets/perl/dperl.pl
---

<h2>dperl.pl - Helps maintaining your perl project</h2>
<ol>
    <li><a href="#description">Description</a></li>
    <li><a href="#features">Features</a></li>
    <li><a href="#synopsis">Synopsis</a></li>
    <li><a href="#attributes_and_methods">Internal attributes and methods</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#config_file">Sample config file</a></li>
    <li><a href="#share">Sharing the module</a></li>
    <li><a href="#changes_file">Changes file</a></li>
    <li><a href="#resources">Resources</a></li>
    <li><a href="#license">License</a></li>
</ol>

<h3 id="description">Description</h3>
<p>
    <code>dperl</code> is a result of <acronym title="jhthorsen@cpan.org">me</acronym>
    getting tired of doing the same stuff - or rather forgetting to do the same stuff for
    each of my perl projects. dperl does <i>not</i> feature the same things
    as <a href="http://search.cpan.org/dist/Dist-Zilla">Dist::Zilla</a>, but
    I would like to think of dperl VS dzil as <a href="http://search.cpan.org/dist/CPAN">cpan</a>
    vs <a href="http://search.cpan.org/dist/App-cpanminus">cpanm</a> - or at
    least that is what I'm aming for (!)
</p>
<p>
    <code>dperl</code> can be tested by running one of the lines below
    in your favourite <a href="http://en.wikipedia.org/wiki/Terminal_emulator">terminal</a>:
</p>
<pre>
# stable
$ wget -q http://bit.ly/dperl -O - | perl -
$ wget -q http://jhthorsen.github.com/snippets/dperl/run -O - | perl -

# experimental
$ wget -q http://github.com/jhthorsen/snippets/raw/master/perl/dperl.pl -O - | perl -
</pre>

<h3 id="features">Features</h3>
<ul>
    <li>
        Generates <a href="http://search.cpan.org/dist/Module-Install">Module::Install</a> styled Makefile.PL
        (..and no - you cannot choose any other) from guesswork and black magic
    </li>
    <li>
        Will insert release date in Changes file, at the first line containing
        a proper formatted version number, and nothing more. Meaning:
        <code>\d+\.[0-9_]+</code>.
    </li>
    <li>Generates compile tests and pod tests</li>
    <li>Generates MANIFEST and MANIFEST.SKIP</li>
    <li>Generates README from top level module</li>
    <li>
        Update VERSION in top module:
        <br><code>s/=head1 VERSION.*?\n=/=head1 VERSION\n\n$VERSION\n\n=/s</code>
        <br><code>s/\$VERSION\s*=.*$/\$VERSION = '$VERSION';/m;</code>
    </li>
    <li>
        Create a dist, without weird files present. (because of generated MANIFEST.SKIP)
    </li>
    <li>Commit and tag the release and pushes the changes to "origin"</li>
    <li>Build and test the project</li>
    <li>Can properly clean up <i>all</i> build files</li>
</ul>

<h3 id="synopsis">Synopsis</h3>
<pre>
Usage dperl.pl [option]

 -update
  * Update version information in main module
  * Create/update t/00-load.t and t/99-pod*t
  * Create/update README

 -build
  * Same as -update
  * Update Changes with release date
  * Create MANIFEST* and META.yml
  * Tag and commit the changes (locally)
  * Build a distribution (.tar.gz)

 -share
  * Push commit and tag to "origin"
  * Upload the disted file to CPAN

 -test
  * Create/update t/00-load.t and t/99-pod*t
  * Test the project

 -clean
  * Remove files and directories which should not be included
    in the project repo

 -makefile
  * Create a Makefile.PL from plain guesswork

 -man
  * Display manual for dperl.pl
</pre>

<h3 id="attributes_and_methods">Internal attributes and methods</h3>

<h4>Dump internal attributes</h4>
<p>
--config, --share-extension, --pause-info, --share-params,
--name, --top-module, --top-module-name, --changes, --dist-file.
</p>

<h4>Run internal methods</h4>
<p>
--tag-and-commit, --share-via-git, --share-via-extension,
--timestamp-to-changes, --update-version-info, --generate-readme, --manifest,
--find-requires, --make.
</p>

<h3 id="requirements">Requirements</h3>
<ul>
    <li>Cwd (core module)</li>
    <li>File::Basename (core module)</li>
    <li>File::Find (core module)</li>
    <li>YAML::Tiny (not in core, but required by CPAN/CPANPLUS)</li>
</ul>

<h3 id="config_file">Sample config file</h3>
<pre>
---
# Default to a converted version of top_module
name: Foo-Bar

# Default to a converted version of the project folder
# Example: ./foo-bar/lib/Foo/Bar.pm, were "foo-bar" is the
# project folder.
top_module: lib/Foo/Bar.pm

# Default to a converted version of top_module.
top_module_name: Foo::Bar

# Default to CPAN::Uploader. Can also be set through
# DPERL_SHARE_MODULE environment variable.
share_extension: AnyModuleName

# Not in use if share_extension == CPAN::Uploader. Usage:
# share_extension-&gt;upload_file($dist_file, share_params);
share_params: { answer: 42 }
</pre>
<p>
    All config params are optional, since <code>dperl</code> will probably figure out
    the information for you.
</p>

<h3 id="share">Sharing the module</h3>
<p>
    By default <a href="http://search.cpan.org/dist/CPAN-Uploader">CPAN::Uploader</a> is used
    to upload the module. This module will use the information from <code>$HOME/.pause</code>
    to find login information:
</p>
<pre>
user your_pause_username
password your_secret_pause_password
</pre>
<p>
    <code>dperl</code> will also use git to push changes and tag a new release:
</p>
<pre>
git commit -a -m "$message_from_changes_file"
git tag "$latest_version_in_changes_file"
git push origin $current_branch
git push --tags origin
</pre>
<p>
    The commit and tag is done when on <code>-dist</code>, while pushing the changes
    to origin is done on <code>-share</code>.
</p>

<h3 id="changes_file">Changes file</h3>
<p>
    The expected format in <code>Changes</code> is:
</p>
<pre>
Some random header, for example:
Revision history for Foo-Bar

0.02
    * Fix something
    * Add something else

0.01 Tue Apr 20 19:34:15 CEST 2010
    * First release
    * Add some feature
</pre>
<p>
    <code>dperl</code> will automatically add the date before creating a dist.
</p>

<h3 id="resources">Resources</h3>
<ul>
    <li><a href="http://github.com/jhthorsen/snippets/blob/master/perl/dperl.pl">Source code</a></li>
    <li><a href="http://github.com/jhthorsen/snippets/issues">Issues</a></li>
</ul>

<h3 id="license">License</h3>
<p>
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
</p>
<p>
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
</p>
<p>
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
</p>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_identifier = 'dperl';
  (function() {
   var dsq = document.createElement('script');
   dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://jhthorsen-github.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=jhthorsen-github">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
